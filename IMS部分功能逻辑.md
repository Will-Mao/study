# IMS部分功能逻辑
---
## 什么时候更新考核提成点
1. 项目提成单流程通过
2. 合同跨阶段收款
3. 决算单
4. 后台任务：计算上月提成记录
## 设置考核提成时间点逻辑
1. 时间要先满足在本月或上月（这里的时间是合同有效日期、实际开工日期。。。等）
2. 再匹配考核时间点设置条件
3. 再根据条件匹配值里面的内容
---
## 核算提成点设置
- 所得提成点比例：根据所选单据中设置的提成乘以现在设置的这个比例为最终提成比例
- 设置目标提成点：不管所选单据中设置的提成比例是多少，最终都按照这里设置的提成比例计算
- 设置增减提成点：不管之前单据中设置提成比例是多少，都按照这个设置进行相应增减
## 什么时候更新核算提成点？
1. 项目提成单流程通过后
2. 回访任务
3. 跨阶段合同收款（项目提成单流程要通过）
4. 决算单流程通过
5. 后台任务：计算上月提成记录

***核算业绩：通过设置的核算业绩得到提成基数***
## 合同决算流程
- 完工登记
- 合同收款完成
- 核算单里完成提成单流程
## 服务器缓存清理
```mermaid
graph LR
应用程序池-->网站-->右键回收
```
---
## 基装
- 基装项目设置为最基本基装项目设置
- 基装报价项目将基装项目与基装材料、工种、工程项目对应起来
- 工人发包单、核算单添加基装明细中添加基装项目数据来源为基装报价项目中已启用为本公司的数据
- 基装材料通知单中选择的材料来源为材料产品设置中被启用的被公司的基装材料

## 材料价格变更
- 核算价：变更后可以在核算单新建主材时立即生效
- 报价：在合同签单前变更可以在此合同选择主材时生效，在合同签单后变更则不生效（主材确认单中查看）
- 成本价：变更后可以在材料采购单中选择主材时立即生效

## 工人发包单
### 添加基装项目
来源于*基装报价项目*，*基装报价项目*又根据**基装项目**进行设置，**基装项目**再关联***基装工种类型设置***
## 考勤相关
```mermaid
graph TB
h((后台任务))
打卡机考勤明细-->h
考勤组-班次-->h
减免设置-->h
h-->员工打卡记录
员工打卡记录-->ht((后台任务-计算考勤异常))
考勤组-考勤规则-->ht
外出/请假/调休/出差-->ht
ht-->员工异常记录
员工异常记录-->导出考勤汇总计算工资

```

## 生成工资单
```mermaid
graph TB
新建薪资确认单-->工资计算单
工资计算单--->|"确认"|houtai((计算工资单))
houtai-->工资单
```

## 核算单流程个状态转变
开工确认完成
```mermaid
graph TB
完成开工确认单-->z[合同状态:施工中/核算状态:新建]
z-->a(主材确认,通知,基材通知)-->b[合同状态:施工中/核算状态:已选材]
b-->c(完成第一次提成)-->d[合同状态:施工中/核算状态:已核算]
d-->e(完工登记还未指派决算员)-->f[合同状态:已完工/核算状态:已核算]
f-->g(完工登记完成)-->h[合同状态:待决算/核算状态:已核算]
h-->i(完成第二次提成)-->j[合同状态:已决算/核算状态:已决算]
```

## 开工完成自动生成工人发包单逻辑
1. 先在***基装工种类型设置***中设置工种类型（水电安装、水电改造）
2. 使用第一步的工种类型在***基装项目报价***中设置对应报价
3. 前两步的设置最好都是唯一
4. 没有手动新建第一步设置的工种类型的发包单
5. 完成开工申请

## 自动生成材料采购单
```mermaid
graph TB
核算单-->|"完成主材确认、通知、基材"|a(自动核算)
a-->|"核算完成"|b(自动开工申请)
a-->|"核算完成"|d(生成工地项目计划流程表)
b-->|"开工申请完成"|c(自动生成材料采购单)
d-->|"开工申请完成"|e(写入工地登记项目计划)
```

## 工费发放申请（之一）
```mermaid
graph TB
工人发包单-->|"完成"|a(发包记录)
a-->|"用工申请"|b(工人发包验收单)
b-->|"验收完成"|c(自动新建工费发放申请)
```
列1|列2|列3|列4|列5
:-|-|-|-|-
行1|单元格1|单元格4|单元格5|单元格7
行2|单元格2|单元格3|单元格6|单元格8

---
`print("asd")`
```
def asd():
	hhh = "juy"
	for i in hhh:
		print(i)
```

---
```mermaid
graph RL
fangxing[默认方形]
roundedRect(圆角矩形)
round((圆形))
condition{菱形}
tag>标签]
```

```mermaid
graph LR
test((目标))
直线---test
虚线-.-test
箭头-->test
虚线箭头-.->test
粗直线===test
粗线箭头==>test
加标签---|"标签"|test
```

```mermaid
graph LR
subgraph zitu
start---dd
end
```

这是一个页面连接[asd](www.baidu.com)
网页连接<https://www.baidu.com>
<font color=green size=8 face=雅黑 >字体颜色大小</font>